# ==================== Ù†Ø¸Ø§Ù… Ø§Ù„Ø³Ø­Ø¨ ====================
async def show_withdraw_menu(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
    """Ø¹Ø±Ø¶ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø³Ø­Ø¨"""
    try:
        query = update.callback_query
        await query.answer()

        user_id = query.from_user.id
        user_data = get_user_data(user_id)
        balance = user_data[4] if user_data else 0

        keyboard = [
            [InlineKeyboardButton("ğŸ’³ Ø³Ø­Ø¨ Ø§Ù„Ø£Ø±Ø¨Ø§Ø­ (24 Ø³Ø§Ø¹Ø©)", callback_data="withdraw_profits")],
            [InlineKeyboardButton("ğŸ Ø³Ø­Ø¨ Ø§Ù„Ù…ÙƒØ§ÙØ¢Øª (Ø£Ø³Ø¨ÙˆØ¹ÙŠ)", callback_data="withdraw_bonus")],
            [InlineKeyboardButton("ğŸ”™ Ø±Ø¬ÙˆØ¹", callback_data="back_to_main")]
        ]
        reply_markup = InlineKeyboardMarkup(keyboard)

        await query.edit_message_text(
            f"ğŸ’³ Ù†Ø¸Ø§Ù… Ø§Ù„Ø³Ø­Ø¨\n\n"
            f"ğŸ’° Ø±ØµÙŠØ¯Ùƒ Ø§Ù„Ø­Ø§Ù„ÙŠ: {balance:.2f} USDT\n\n"
            f"ğŸ“‹ Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ø³Ø­Ø¨:\n"
            f"â€¢ Ø³Ø­Ø¨ Ø§Ù„Ø£Ø±Ø¨Ø§Ø­: ÙƒÙ„ 24 Ø³Ø§Ø¹Ø© (25$ - 1000$)\n"
            f"â€¢ Ø³Ø­Ø¨ Ø§Ù„Ù…ÙƒØ§ÙØ¢Øª: ÙƒÙ„ Ø£Ø³Ø¨ÙˆØ¹ (Ù„Ø§ Ø­Ø¯ÙˆØ¯)\n\n"
            f"Ø§Ø®ØªØ± Ù†ÙˆØ¹ Ø§Ù„Ø³Ø­Ø¨:",
            reply_markup=reply_markup
        )
    except Exception as e:
        logger.error(f"âŒ Ø®Ø·Ø£ ÙÙŠ Ø¹Ø±Ø¶ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø³Ø­Ø¨: {e}")
        await send_error_notification(f"Ø®Ø·Ø£ ÙÙŠ Ø¹Ø±Ø¶ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø³Ø­Ø¨: {e}")
# ==================== Ù†Ø¸Ø§Ù… Ø§Ù„Ø³Ø­Ø¨ ====================
async def show_withdraw_menu(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
    """Ø¹Ø±Ø¶ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø³Ø­Ø¨"""
    try:
        query = update.callback_query
        await query.answer()

        user_id = query.from_user.id
        user_data = get_user_data(user_id)
        balance = user_data[4] if user_data else 0

        keyboard = [
            [InlineKeyboardButton("ğŸ’³ Ø³Ø­Ø¨ Ø§Ù„Ø£Ø±Ø¨Ø§Ø­ (24 Ø³Ø§Ø¹Ø©)", callback_data="withdraw_profits")],
            [InlineKeyboardButton("ğŸ Ø³Ø­Ø¨ Ø§Ù„Ù…ÙƒØ§ÙØ¢Øª (Ø£Ø³Ø¨ÙˆØ¹ÙŠ)", callback_data="withdraw_bonus")],
            [InlineKeyboardButton("ğŸ”™ Ø±Ø¬ÙˆØ¹", callback_data="back_to_main")]
        ]
        reply_markup = InlineKeyboardMarkup(keyboard)

        await query.edit_message_text(
            f"ğŸ’³ Ù†Ø¸Ø§Ù… Ø§Ù„Ø³Ø­Ø¨\n\n"
            f"ğŸ’° Ø±ØµÙŠØ¯Ùƒ Ø§Ù„Ø­Ø§Ù„ÙŠ: {balance:.2f} USDT\n\n"
            f"ğŸ“‹ Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ø³Ø­Ø¨:\n"
            f"â€¢ Ø³Ø­Ø¨ Ø§Ù„Ø£Ø±Ø¨Ø§Ø­: ÙƒÙ„ 24 Ø³Ø§Ø¹Ø© (25$ - 1000$)\n"
            f"â€¢ Ø³Ø­Ø¨ Ø§Ù„Ù…ÙƒØ§ÙØ¢Øª: ÙƒÙ„ Ø£Ø³Ø¨ÙˆØ¹ (Ù„Ø§ Ø­Ø¯ÙˆØ¯)\n\n"
            f"Ø§Ø®ØªØ± Ù†ÙˆØ¹ Ø§Ù„Ø³Ø­Ø¨:",
            reply_markup=reply_markup
        )
    except Exception as e:
        logger.error(f"âŒ Ø®Ø·Ø£ ÙÙŠ Ø¹Ø±Ø¶ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø³Ø­Ø¨: {e}")
        await send_error_notification(f"Ø®Ø·Ø£ ÙÙŠ Ø¹Ø±Ø¶ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø³Ø­Ø¨: {e}")
# ==================== Ù…Ø¹Ø§Ù„Ø¬Ø© Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…Ø­ÙØ¸Ø©====================
async def handle_wallet_address(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """Ù…Ø¹Ø§Ù„Ø¬Ø© Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…Ø­ÙØ¸Ø© Ù…Ø¹ Ù†Ø¸Ø§Ù… Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©"""
    try:
        user_id = update.effective_user.id
        wallet_address = update.message.text.strip()

        # Ø¥Ø±Ø³Ø§Ù„ "Ø¬Ø§Ø±ÙŠ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø·Ù„Ø¨" ÙÙˆØ±Ø§Ù‹
        processing_msg = await update.message.reply_text(
            "ğŸ”„ Ø¬Ø§Ø±ÙŠ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø·Ù„Ø¨Ùƒ...\n\n"
            "Ø³ÙŠØªÙ… Ù…Ø±Ø§Ø¬Ø¹Ø© Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…Ø­ÙØ¸Ø© ÙˆØªÙØ¹ÙŠÙ„Ù‡ Ø®Ù„Ø§Ù„ Ø¯Ù‚Ø§Ø¦Ù‚."
        )

        # ØªØ­Ù‚Ù‚ Ù…Ù† Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…Ø­ÙØ¸Ø©
        if len(wallet_address) < 10 or not wallet_address.startswith(('0x', '1', '3', 'bc1')):
            await processing_msg.edit_text(
                "âŒ Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…Ø­ÙØ¸Ø© ØºÙŠØ± ØµØ§Ù„Ø­. ÙŠØ±Ø¬Ù‰ Ø¥Ø±Ø³Ø§Ù„ Ø¹Ù†ÙˆØ§Ù† ØµØ­ÙŠØ­:"
            )
            return

        # Ø­ÙØ¸ ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        conn = sqlite3.connect('trading_bot.db')
        c = conn.cursor()
        c.execute(
            'UPDATE users SET wallet_address = ? WHERE user_id = ?',
            (wallet_address, user_id)
        )
        conn.commit()
        conn.close()

        # Ù…Ø³Ø­ Ø­Ø§Ù„Ø© Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±
        del context.user_data['awaiting_wallet']

        await processing_msg.edit_text(
            f"âœ… ØªÙ… Ø§Ø³ØªÙ„Ø§Ù… Ø¹Ù†ÙˆØ§Ù† Ù…Ø­ÙØ¸ØªÙƒ Ø¨Ù†Ø¬Ø§Ø­!\n\n"
            f"ğŸ“ Ø§Ù„Ø¹Ù†ÙˆØ§Ù†: {wallet_address}\n\n"
            f"ğŸ”„ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© Ù…Ù† Ù‚Ø¨Ù„ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©...\n"
            f"Ø³ÙŠØªÙ… Ø¥Ø¹Ù„Ø§Ù…Ùƒ ÙÙˆØ± Ø§Ù„ØªÙØ¹ÙŠÙ„."
        )

        # Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨ Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ù„Ù„Ù‚Ù†Ø§Ø© Ù…Ø¹ Ø§Ù„Ø£Ø²Ø±Ø§Ø±
        keyboard = [
            [InlineKeyboardButton("âœ… ØªÙ… Ø§Ù„ØªØ­ÙˆÙŠÙ„", callback_data=f"confirm_transfer:{user_id}")],
            [InlineKeyboardButton("âŒ ØªÙ… Ø§Ù„Ø±ÙØ¶", callback_data=f"reject_transfer:{user_id}")],
            [InlineKeyboardButton("ğŸ“© Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø©", callback_data=f"message_user:{user_id}")]
        ]
        reply_markup = InlineKeyboardMarkup(keyboard)

        await context.bot.send_message(
            chat_id=ADMIN_CHAT_ID,
            text=f"ğŸ”„ Ø·Ù„Ø¨ ØªØ­ÙˆÙŠÙ„ Ø¬Ø¯ÙŠØ¯:\n\n"
                 f"ğŸ‘¤ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…: {user_id}\n"
                 f"ğŸ“› Ø§Ù„Ø§Ø³Ù…: {update.effective_user.first_name}\n"
                 f"ğŸ”— Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…: @{update.effective_user.username or 'Ø¨Ø¯ÙˆÙ†'}\n"
                 f"ğŸ“ Ø§Ù„Ù…Ø­ÙØ¸Ø©: {wallet_address}\n\n"
                 f"â° Ø§Ù„ÙˆÙ‚Øª: {update.message.date}",
            reply_markup=reply_markup
        )

    except Exception as e:
        logger.error(f"Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ù…Ø­ÙØ¸Ø©: {e}")
        await update.message.reply_text("âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ù…Ø­ÙØ¸Ø©. Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.")
    except Exception as e:
        print(f"âŒ Ø®Ø·Ø£ ÙÙŠ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø·Ù„Ø¨ Ø§Ù„Ø³Ø­Ø¨: {e}")
        await update.message.reply_text("âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø·Ù„Ø¨ Ø§Ù„Ø³Ø­Ø¨. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.")
async def handle_approve_withdraw(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """Ù…ÙˆØ§ÙÙ‚Ø© Ø§Ù„Ø£Ø¯Ù…Ù† Ø¹Ù„Ù‰ Ø§Ù„Ø³Ø­Ø¨"""
    try:
        query = update.callback_query
        data = query.data.split('_')
        user_id = int(data[2])
        amount = float(data[3])

        # Ø®ØµÙ… Ø§Ù„Ù…Ø¨Ù„Øº Ø¨Ø¹Ø¯ Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø©
        conn = sqlite3.connect('trading_bot.db')
        c = conn.cursor()
        c.execute("UPDATE users SET balance = balance - ? WHERE user_id = ?", (amount, user_id))
        c.execute("UPDATE withdraw_requests SET status = 'approved' WHERE user_id = ? AND status = 'pending'", (user_id,))
        conn.commit()
        conn.close()

        # Ø¥Ø´Ø¹Ø§Ø± Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
        app = Application.builder().token(MAIN_BOT_TOKEN).build()
        await app.bot.send_message(
            chat_id=user_id,
            text=f"âœ… ØªÙ…Øª Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ø¹Ù„Ù‰ Ø³Ø­Ø¨Ùƒ!\n\n"
                 f"ğŸ’° Ø§Ù„Ù…Ø¨Ù„Øº: {amount} USDT\n"
                 f"ğŸ’³ ØªÙ… ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ù…Ø¨Ù„Øº Ù„Ù…Ø­ÙØ¸ØªÙƒ\n"
                 f"â° Ù‚Ø¯ ÙŠØ³ØªØºØ±Ù‚ Ø§Ù„ØªØ­ÙˆÙŠÙ„ 2-24 Ø³Ø§Ø¹Ø©\n\n"
                 f"Ø´ÙƒØ±Ø§Ù‹ Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…Ùƒ Ø®Ø¯Ù…Ø§ØªÙ†Ø§! ğŸ‰"
        )

        await query.edit_message_text(
            f"âœ… ØªÙ…Øª Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ø¹Ù„Ù‰ Ø³Ø­Ø¨ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… {user_id}\n"
            f"ğŸ’° Ø§Ù„Ù…Ø¨Ù„Øº: {amount} USDT\n\n"
            f"ğŸ“ ØªÙ… Ø¥Ø¹Ù„Ø§Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ø§Ù„ØªØ­ÙˆÙŠÙ„."
        )

    except Exception as e:
        print(f"âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø³Ø­Ø¨: {e}")

async def handle_reject_withdraw(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """Ø±ÙØ¶ Ø§Ù„Ø£Ø¯Ù…Ù† Ù„Ù„Ø³Ø­Ø¨"""
    try:
        query = update.callback_query
        data = query.data.split('_')
        user_id = int(data[2])
        amount = float(data[3])

        # ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨ ÙÙ‚Ø· (Ø¨Ø¯ÙˆÙ† Ø®ØµÙ…)
        conn = sqlite3.connect('trading_bot.db')
        c = conn.cursor()
        c.execute("UPDATE withdraw_requests SET status = 'rejected' WHERE user_id = ? AND status = 'pending'", (user_id,))
        conn.commit()
        conn.close()

        # Ø¥Ø´Ø¹Ø§Ø± Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
        app = Application.builder().token(MAIN_BOT_TOKEN).build()
        await app.bot.send_message(
            chat_id=user_id,
            text=f"âŒ ØªÙ… Ø±ÙØ¶ Ø·Ù„Ø¨ Ø§Ù„Ø³Ø­Ø¨\n\n"
                 f"ğŸ’° Ø§Ù„Ù…Ø¨Ù„Øº: {amount} USDT\n"
                 f"ğŸ’³ Ù„Ù… ÙŠØªÙ… Ø®ØµÙ… Ø£ÙŠ Ù…Ø¨Ù„Øº Ù…Ù† Ø±ØµÙŠØ¯Ùƒ\n\n"
                 f"ğŸ“ Ù„Ù„Ø§Ø³ØªÙØ³Ø§Ø±ØŒ ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ø§Ù„Ø¯Ø¹Ù…."
        )

        await query.edit_message_text(
            f"âŒ ØªÙ… Ø±ÙØ¶ Ø³Ø­Ø¨ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… {user_id}\n"
            f"ğŸ’° Ø§Ù„Ù…Ø¨Ù„Øº: {amount} USDT\n\n"
            f"ğŸ’³ Ù„Ù… ÙŠØªÙ… Ø®ØµÙ… Ø§Ù„Ø±ØµÙŠØ¯."
        )

    except Exception as e:
        print(f"âŒ Ø®Ø·Ø£ ÙÙŠ Ø±ÙØ¶ Ø§Ù„Ø³Ø­Ø¨: {e}")

async def handle_withdraw_profits(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """Ù…Ø¹Ø§Ù„Ø¬Ø© Ø³Ø­Ø¨ Ø§Ù„Ø£Ø±Ø¨Ø§Ø­"""
    try:
        query = update.callback_query
        await query.answer()

        user_id = query.from_user.id
        user_data = get_user_data(user_id)
        balance = user_data[4] if user_data else 0

        # Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰
        if balance < 25:
            await query.edit_message_text(
                f"âŒ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„Ø³Ø­Ø¨\n\n"
                f"ğŸ’° Ø±ØµÙŠØ¯Ùƒ Ø§Ù„Ø­Ø§Ù„ÙŠ: {balance:.2f} USDT\n"
                f"ğŸ“Š Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰ Ù„Ù„Ø³Ø­Ø¨: 25 USDT\n\n"
                f"ğŸ’¡ Ø§Ø³ØªÙ…Ø± ÙÙŠ Ø§Ù„ØªØ¯Ø§ÙˆÙ„ Ù„ØªØ¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø±Ø¨Ø§Ø­!",
                reply_markup=InlineKeyboardMarkup([
                    [InlineKeyboardButton("ğŸ”™ Ø±Ø¬ÙˆØ¹", callback_data="withdraw_menu")]
                ])
            )
            return

        # Ø¹Ø±Ø¶ Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ø³Ø­Ø¨
        keyboard = [
            [InlineKeyboardButton("25 USDT", callback_data="withdraw_amount_25")],
            [InlineKeyboardButton("50 USDT", callback_data="withdraw_amount_50")],
            [InlineKeyboardButton("100 USDT", callback_data="withdraw_amount_100")],
            [InlineKeyboardButton("250 USDT", callback_data="withdraw_amount_250")],
            [InlineKeyboardButton("500 USDT", callback_data="withdraw_amount_500")],
            [InlineKeyboardButton("1000 USDT", callback_data="withdraw_amount_1000")],
            [InlineKeyboardButton("ğŸ”™ Ø±Ø¬ÙˆØ¹", callback_data="withdraw_menu")]
        ]
        reply_markup = InlineKeyboardMarkup(keyboard)

        await query.edit_message_text(
            f"ğŸ’³ Ø³Ø­Ø¨ Ø§Ù„Ø£Ø±Ø¨Ø§Ø­\n\n"
            f"ğŸ’° Ø±ØµÙŠØ¯Ùƒ Ø§Ù„Ø­Ø§Ù„ÙŠ: {balance:.2f} USDT\n"
            f"â° Ù…Ø¯Ø© Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©: 24 Ø³Ø§Ø¹Ø©\n\n"
            f"ğŸ“Š Ø§Ø®ØªØ± Ù…Ø¨Ù„Øº Ø§Ù„Ø³Ø­Ø¨:",
            reply_markup=reply_markup
        )

    except Exception as e:
        print(f"âŒ Ø®Ø·Ø£ ÙÙŠ Ø³Ø­Ø¨ Ø§Ù„Ø£Ø±Ø¨Ø§Ø­: {e}")

async def handle_withdraw_bonus(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """Ù…Ø¹Ø§Ù„Ø¬Ø© Ø³Ø­Ø¨ Ø§Ù„Ù…ÙƒØ§ÙØ¢Øª"""
    try:
        query = update.callback_query
        await query.answer()

        user_id = query.from_user.id
        user_data = get_user_data(user_id)
        balance = user_data[4] if user_data else 0

        # Ø·Ù„Ø¨ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø­ÙØ¸Ø©
        context.user_data['awaiting_wallet'] = True
        context.user_data['withdraw_type'] = 'bonus'

        await query.edit_message_text(
            f"ğŸ Ø³Ø­Ø¨ Ø§Ù„Ù…ÙƒØ§ÙØ¢Øª\n\n"
            f"ğŸ’° Ø±ØµÙŠØ¯Ùƒ Ø§Ù„Ø­Ø§Ù„ÙŠ: {balance:.2f} USDT\n"
            f"â° Ù…Ø¯Ø© Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©: 48 Ø³Ø§Ø¹Ø©\n\n"
            f"ğŸ’³ Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø±Ø³Ø§Ù„ Ø¹Ù†ÙˆØ§Ù† Ù…Ø­ÙØ¸ØªÙƒ USDT (TRC20):\n\n"
            f"ğŸ“ Ù…Ø«Ø§Ù„:\n"
            f"TYy5CnBE3k6g5aNZhTNLX1WEnLk6fQ5Xz2",
            reply_markup=InlineKeyboardMarkup([
                [InlineKeyboardButton("ğŸ”™ Ø±Ø¬ÙˆØ¹", callback_data="withdraw_menu")]
            ])
        )

    except Exception as e:
        print(f"âŒ Ø®Ø·Ø£ ÙÙŠ Ø³Ø­Ø¨ Ø§Ù„Ù…ÙƒØ§ÙØ¢Øª: {e}")

async def handle_withdraw_amount(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """Ù…Ø¹Ø§Ù„Ø¬Ø© Ù…Ø¨Ù„Øº Ø§Ù„Ø³Ø­Ø¨ Ø§Ù„Ù…Ø­Ø¯Ø¯"""
    try:
        query = update.callback_query
        await query.answer()

        data = query.data
        amount = int(data.split('_')[2])  # withdraw_amount_100 â†’ 100

        user_id = query.from_user.id
        user_data = get_user_data(user_id)
        balance = user_data[4] if user_data else 0

        if balance < amount:
            await query.answer(f"âŒ Ø±ØµÙŠØ¯Ùƒ ØºÙŠØ± ÙƒØ§ÙÙŠ", show_alert=True)
            return

        # Ø·Ù„Ø¨ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø­ÙØ¸Ø©
        context.user_data['awaiting_wallet'] = True
        context.user_data['withdraw_type'] = 'profits'
        context.user_data['withdraw_amount'] = amount

        await query.edit_message_text(
            f"ğŸ’³ ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø³Ø­Ø¨\n\n"
            f"ğŸ“Š Ø§Ù„Ù…Ø¨Ù„Øº: {amount} USDT\n"
            f"ğŸ’° Ø§Ù„Ø±ØµÙŠØ¯ Ø¨Ø¹Ø¯ Ø§Ù„Ø³Ø­Ø¨: {balance - amount:.2f} USDT\n"
            f"â° Ù…Ø¯Ø© Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©: 24 Ø³Ø§Ø¹Ø©\n\n"
            f"ğŸ’³ Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø±Ø³Ø§Ù„ Ø¹Ù†ÙˆØ§Ù† Ù…Ø­ÙØ¸ØªÙƒ USDT (TRC20):",
            reply_markup=InlineKeyboardMarkup([
                [InlineKeyboardButton("ğŸ”™ Ø±Ø¬ÙˆØ¹", callback_data="withdraw_profits")]
            ])
        )
    except Exception as e:
        print(f"âŒ Ø®Ø·Ø£ ÙÙŠ Ù…Ø¹Ø§Ù„Ø¬Ø© Ù…Ø¨Ù„Øº Ø§Ù„Ø³Ø­Ø¨: {e}")

async def handle_approve_withdraw(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """Ù…ÙˆØ§ÙÙ‚Ø© Ø§Ù„Ø£Ø¯Ù…Ù† Ø¹Ù„Ù‰ Ø§Ù„Ø³Ø­Ø¨"""
    try:
        query = update.callback_query
        await query.answer("âœ… ØªÙ…Øª Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø³Ø­Ø¨")

        # Ù…Ø¬Ø±Ø¯ ØªØ£ÙƒÙŠØ¯ Ø¨Ø³ÙŠØ·
        await query.edit_message_text("âœ… ØªÙ…Øª Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ø¹Ù„Ù‰ Ø·Ù„Ø¨ Ø§Ù„Ø³Ø­Ø¨ Ø¨Ù†Ø¬Ø§Ø­!")

    except Exception as e:
        print(f"âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø³Ø­Ø¨: {e}")

async def handle_reject_withdraw(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """Ø±ÙØ¶ Ø§Ù„Ø£Ø¯Ù…Ù† Ù„Ù„Ø³Ø­Ø¨"""
    try:
        query = update.callback_query
        await query.answer("âŒ ØªÙ… Ø±ÙØ¶ Ø§Ù„Ø³Ø­Ø¨")

        # Ù…Ø¬Ø±Ø¯ ØªØ£ÙƒÙŠØ¯ Ø¨Ø³ÙŠØ·
        await query.edit_message_text("âŒ ØªÙ… Ø±ÙØ¶ Ø·Ù„Ø¨ Ø§Ù„Ø³Ø­Ø¨!")

    except Exception as e:
        print(f"âŒ Ø®Ø·Ø£ ÙÙŠ Ø±ÙØ¶ Ø§Ù„Ø³Ø­Ø¨: {e}")

async def handle_withdrawal_request(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """Ù…Ø¹Ø§Ù„Ø¬Ø© Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø³Ø­Ø¨ Ø¨Ø¯ÙˆÙ† Ø­ÙØ¸ Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…Ø­ÙØ¸Ø©"""
    try:
        user_id = update.effective_user.id

        # Ø§Ù„ØªØ­Ù‚Ù‚ Ø¥Ø°Ø§ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø³Ø¬Ù„
        conn = sqlite3.connect('trading_bot.db')
        c = conn.cursor()
        c.execute('SELECT balance, full_name FROM users WHERE user_id = ?', (user_id,))
        user_data = c.fetchone()
        conn.close()

        if not user_data:
            await update.message.reply_text("âŒ ÙŠØ¬Ø¨ Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø£ÙˆÙ„Ø§Ù‹ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… /start")
            return

        balance, full_name = user_data

        if balance <= 0:
            await update.message.reply_text("âŒ Ø±ØµÙŠØ¯Ùƒ ØºÙŠØ± ÙƒØ§ÙÙŠ Ù„Ù„Ø³Ø­Ø¨")
            return

        # Ø·Ù„Ø¨ Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…Ø­ÙØ¸Ø© Ù…Ø¨Ø§Ø´Ø±Ø© Ù„Ù„Ø³Ø­Ø¨ Ø§Ù„Ø­Ø§Ù„ÙŠ
        context.user_data['awaiting_withdrawal_wallet'] = True
        context.user_data['withdrawal_user_id'] = user_id

        await update.message.reply_text(
            f"ğŸ’° Ø·Ù„Ø¨ Ø³Ø­Ø¨ Ø¬Ø¯ÙŠØ¯\n\n"
            f"ğŸ‘¤ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…: {full_name}\n"
            f"ğŸ’³ Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ù…ØªØ§Ø­: {balance}\n\n"
            "ğŸ”— ÙŠØ±Ø¬Ù‰ Ø¥Ø±Ø³Ø§Ù„ Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…Ø­ÙØ¸Ø© Ù„Ù„Ø³Ø­Ø¨:"
        )

    except Exception as e:
        logger.error(f"Ø®Ø·Ø£ ÙÙŠ Ø·Ù„Ø¨ Ø§Ù„Ø³Ø­Ø¨: {e}")
        await update.message.reply_text("âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø·Ù„Ø¨Ùƒ")

async def handle_withdrawal_wallet(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """Ù…Ø¹Ø§Ù„Ø¬Ø© Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…Ø­ÙØ¸Ø© Ù„Ù„Ø³Ø­Ø¨ Ø§Ù„Ø­Ø§Ù„ÙŠ ÙÙ‚Ø·"""
    try:
        user_id = context.user_data.get('withdrawal_user_id')
        wallet_address = update.message.text.strip()
        amount = context.user_data.get('withdrawal_amount')

        if not user_id:
            await update.message.reply_text("âŒ Ø¬Ù„Ø³Ø© Ù…Ù†ØªÙ‡ÙŠØ©ØŒ Ø§Ø¨Ø¯Ø£ Ø·Ù„Ø¨ Ø³Ø­Ø¨ Ø¬Ø¯ÙŠØ¯")
            return

        # ØªØ­Ù‚Ù‚ Ø¨Ø³ÙŠØ· Ù…Ù† Ø§Ù„Ø¹Ù†ÙˆØ§Ù†
        if len(wallet_address) < 10:
            await update.message.reply_text("âŒ Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…Ø­ÙØ¸Ø© Ù‚ØµÙŠØ± Ø¬Ø¯Ø§Ù‹")
            return

        # Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
        conn = sqlite3.connect('trading_bot.db')
        c = conn.cursor()
        c.execute('SELECT balance, full_name, username FROM users WHERE user_id = ?', (user_id,))
        user_data = c.fetchone()
        conn.close()

        if not user_data:
            await update.message.reply_text("âŒ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯")
            return

        balance, full_name, username = user_data

        # Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨ Ø§Ù„Ø³Ø­Ø¨ Ù„Ù„Ù‚Ù†Ø§Ø© Ù…Ø¹ Ø§Ù„Ø£Ø²Ø±Ø§Ø±
        keyboard = [
            [InlineKeyboardButton("ğŸ”„ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©", callback_data=f"processing_withdrawal:{user_id}:{amount}")],
            [InlineKeyboardButton("âœ… ØªÙ… Ø§Ù„ØªØ­ÙˆÙŠÙ„", callback_data=f"confirm_withdrawal:{user_id}:{amount}")],
            [InlineKeyboardButton("âŒ Ø±ÙØ¶ Ø§Ù„Ø·Ù„Ø¨", callback_data=f"reject_withdrawal:{user_id}")],
            [InlineKeyboardButton("ğŸ“© Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø©", callback_data=f"message_user:{user_id}")]
        ]
        reply_markup = InlineKeyboardMarkup(keyboard)

        await context.bot.send_message(
            chat_id=ADMIN_CHAT_ID,
            text=f"ğŸ”„ Ø·Ù„Ø¨ Ø³Ø­Ø¨ Ø¬Ø¯ÙŠØ¯:\n\n"
                 f"ğŸ‘¤ Ø§Ù„Ø§Ø³Ù…: {full_name or 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}\n"
                 f"ğŸ”— @{username or 'Ø¨Ø¯ÙˆÙ†'}\n"
                 f"ğŸ†” ID: {user_id}\n"
                 f"ğŸ’° Ø§Ù„Ù…Ø¨Ù„Øº: {amount}\n"
                 f"ğŸ’³ Ø§Ù„Ø±ØµÙŠØ¯: {balance}\n"
                 f"ğŸ”— Ø§Ù„Ù…Ø­ÙØ¸Ø©: {wallet_address}\n\n"
                 f"â° {update.message.date}",
            reply_markup=reply_markup
        )

        # ØªØ£ÙƒÙŠØ¯ Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…
        await update.message.reply_text(
            f"âœ… ØªÙ… Ø§Ø³ØªÙ„Ø§Ù… Ø·Ù„Ø¨ Ø§Ù„Ø³Ø­Ø¨!\n\n"
            f"ğŸ’³ Ø§Ù„Ù…Ø­ÙØ¸Ø©: {wallet_address}\n"
            f"ğŸ’° Ø§Ù„Ù…Ø¨Ù„Øº: {amount}\n\n"
            f"ğŸ”„ Ø¬Ø§Ø±ÙŠ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø·Ù„Ø¨Ùƒ..."
        )

        # Ù…Ø³Ø­ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¤Ù‚ØªØ©
        for key in ['awaiting_withdrawal_wallet', 'withdrawal_user_id', 'withdrawal_amount']:
            context.user_data.pop(key, None)

    except Exception as e:
        logger.error(f"Ø®Ø·Ø£ ÙÙŠ Ù…Ø¹Ø§Ù„Ø¬Ø© Ù…Ø­ÙØ¸Ø© Ø§Ù„Ø³Ø­Ø¨: {e}")
        await update.message.reply_text("âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø·Ù„Ø¨")
async def handle_wallet_address(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """Ù…Ø¹Ø§Ù„Ø¬Ø© Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…Ø­ÙØ¸Ø© (Ù…Ø¹Ø¯Ù„)"""
    try:
        user_id = update.effective_user.id
        wallet_address = update.message.text.strip()

        # ØªØ­Ù‚Ù‚ Ø¨Ø³ÙŠØ· ÙÙ‚Ø· (Ø£ÙŠ Ù†Øµ Ø¨Ø·ÙˆÙ„ Ù…Ø¹Ù‚ÙˆÙ„ Ù…Ù‚Ø¨ÙˆÙ„)
        if len(wallet_address) < 10:
            await update.message.reply_text("âŒ Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…Ø­ÙØ¸Ø© Ù‚ØµÙŠØ± Ø¬Ø¯Ø§Ù‹")
            return

        # Ø­ÙØ¸ ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        conn = sqlite3.connect('trading_bot.db')
        c = conn.cursor()
        c.execute(
            'UPDATE users SET wallet_address = ? WHERE user_id = ?',
            (wallet_address, user_id)
        )
        conn.commit()
        conn.close()

        # Ù…Ø³Ø­ Ø­Ø§Ù„Ø© Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±
        del context.user_data['awaiting_wallet']

        await update.message.reply_text(
            f"âœ… ØªÙ… Ø­ÙØ¸ Ø¹Ù†ÙˆØ§Ù† Ù…Ø­ÙØ¸ØªÙƒ!\n\n"
            f"ğŸ“ {wallet_address}\n\n"
            "Ø§Ù„Ø¢Ù† ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ø³ØªØ®Ø¯Ø§Ù… /withdraw Ù„Ù„Ø³Ø­Ø¨"
        )

    except Exception as e:
        logger.error(f"Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ù…Ø­ÙØ¸Ø©: {e}")
        await update.message.reply_text("âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ù…Ø­ÙØ¸Ø©")

# ==================== Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø­Ø§ÙØ¸ ====================
async def admin_wallets(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
    """Ø¥Ø¯Ø§Ø±Ø© Ù…Ø­Ø§ÙØ¸ Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…"""
    try:
        query = update.callback_query
        await query.answer()

        wallet_text = (
            f"ğŸ’³ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø­Ø§ÙØ¸\n\n"
            f"ğŸ“ Ø§Ù„Ù…Ø­ÙØ¸Ø© Ø§Ù„Ù†Ø´Ø·Ø©:\n"
            f"`{WALLET_ADDRESS}`\n\n"
            f"ğŸŒ Ø§Ù„Ø´Ø¨ÙƒØ©: TRC20\n"
            f"â° Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«: {datetime.now().strftime('%Y-%m-%d %H:%M')}"
        )

        keyboard = [
            [InlineKeyboardButton("âœï¸ ØªØºÙŠÙŠØ± Ø§Ù„Ø¹Ù†ÙˆØ§Ù†", callback_data="change_wallet")],
            [InlineKeyboardButton("ğŸ”™ Ø±Ø¬ÙˆØ¹", callback_data="back_to_admin")]
        ]
        reply_markup = InlineKeyboardMarkup(keyboard)

        await query.edit_message_text(wallet_text, reply_markup=reply_markup, parse_mode='Markdown')
    except Exception as e:
        logger.error(f"âŒ Ø®Ø·Ø£ ÙÙŠ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø­Ø§ÙØ¸: {e}")
        await send_error_notification(f"Ø®Ø·Ø£ ÙÙŠ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø­Ø§ÙØ¸: {e}")
